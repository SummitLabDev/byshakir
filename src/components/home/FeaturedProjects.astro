---
import { getCollection } from 'astro:content';
import SectionHeading from '../common/SectionHeading.astro';
import ProjectCard from '../projects/ProjectCard.astro';
import Button from '../common/Button.astro';

// Helper to get clean slug from filename
const getSlug = (id: string) => id.replace(/\.md$/, '');

// Get featured projects, sorted by order
const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter((project) => project.data.featured)
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 3);
---

<section class="py-24 lg:py-32 bg-black">
  <div class="container-luxury">
    <SectionHeading
      subtitle="Our Work"
      title="Featured Projects"
    />

    {featuredProjects.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
        {featuredProjects.map((project) => (
          <ProjectCard
            slug={getSlug(project.id)}
            title={project.data.title}
            location={project.data.location}
            country={project.data.country}
            image={project.data.heroImage}
            eager={true}
          />
        ))}
      </div>
    ) : (
      <p class="text-center text-cream/60">Projects coming soon...</p>
    )}

    <div class="mt-12 text-center">
      <Button href="/projects" variant="outline" size="md">
        View All Projects
      </Button>
    </div>
  </div>
</section>
